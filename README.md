# SHHH

A simple service for sharing secrets securely. Encrypt your text or files, share a link, and they'll self-destruct after being retrieved once.

Inspired by [umputun/secrets](https://github.com/umputun/secrets/).
ReadMe generated by AI.

## What it does

SHHH encrypts secrets client-side using AES-256-GCM with Argon2id key derivation. Everything is stored in memory (nothing touches disk), and secrets are automatically deleted after being retrieved or when they expire. There's a web UI if you want it, or you can use the API directly.

## Features

- AES-256-GCM encryption with Argon2id key derivation
- One-time retrieval (secrets are deleted after being accessed)
- Automatic expiration and cleanup
- Text and file uploads (up to 2MB by default)
- Web UI built with HTMX (no JavaScript framework needed)
- Docker setup with nginx reverse proxy
- Optional SSL/TLS support
- Rate limiting and security headers

## Quick Start

### Docker

The easiest way to run it:

```bash
cp .env.example .env
docker-compose up -d
```

That's it. The app will be available at `http://localhost` (or `https://localhost` if you enable SSL).

### Local Development

If you want to run it locally without Docker:

```bash
go build -o dist/shhh ./cmd/shhh/
./dist/shhh
```

The default port is 8000, but you can change it:

```bash
./dist/shhh -port 8080
```

Or use the Makefile:

```bash
make build
./dist/shhh
```

## Configuration

All settings are controlled via environment variables. Check `.env.example` for the full list. Here are the main ones:

- `SHHH_PORT` - Port the app listens on (default: 8000)
- `SHHH_MIN_PHRASE_SIZE` - Minimum passphrase length (default: 5)
- `SHHH_MAX_PHRASE_SIZE` - Maximum passphrase length (default: 128)
- `SHHH_MAX_ITEMS` - Max number of secrets in memory (default: 100)
- `SHHH_MAX_FILE_SIZE` - Max file size in bytes (default: 2097152 = 2MB)
- `SHHH_MAX_RETENTION` - Maximum time a secret can live (default: 24h)
- `NGINX_SERVER_NAME` - Server name for nginx (default: localhost)
- `NGINX_SSL_ENABLED` - Enable SSL/TLS (default: false)

You can also pass these as command-line flags if running locally.

## SSL Setup

### Development (Self-signed)

For local testing with HTTPS:

```bash
mkdir -p ssl
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout ssl/key.pem \
  -out ssl/cert.pem \
  -subj "/CN=localhost"
```

Then set `NGINX_SSL_ENABLED=true` in your `.env` and restart:

```bash
docker-compose restart
```

### Production (Let's Encrypt)

1. Get your certificate on the host:
   ```bash
   sudo certbot certonly --standalone -d your-domain.com
   ```

2. Either mount the certs directly in `docker-compose.yml`:
   ```yaml
   volumes:
     - /etc/letsencrypt/live/your-domain.com/fullchain.pem:/etc/nginx/ssl/cert.pem:ro
     - /etc/letsencrypt/live/your-domain.com/privkey.pem:/etc/nginx/ssl/key.pem:ro
   ```
   
   Or copy them to a local `ssl/` directory:
   ```bash
   mkdir -p ssl
   sudo cp /etc/letsencrypt/live/your-domain.com/fullchain.pem ssl/cert.pem
   sudo cp /etc/letsencrypt/live/your-domain.com/privkey.pem ssl/key.pem
   ```

3. Set in `.env`:
   ```
   NGINX_SSL_ENABLED=true
   NGINX_SERVER_NAME=your-domain.com
   ```

## API

### Create a text secret

```bash
POST /api/secret
Content-Type: application/json

{
  "secret": "my secret text",
  "passphrase": "mypass",
  "exp": 3600
}
```

Returns:
```json
{
  "key": "abc123...",
  "exp": 3600
}
```

### Create a file secret

```bash
POST /api/file
Content-Type: multipart/form-data

file: <file>
passphrase: mypass
exp: 3600
```

### Retrieve a secret

```bash
POST /api/secret/{id}
Content-Type: application/json

{
  "passphrase": "mypass"
}
```

Returns the decrypted secret. The secret is deleted immediately after retrieval.

### Get configuration parameters

```bash
GET /api/params
```

Returns the current limits and settings (useful for client-side validation).

## Web Interface

The web UI is pretty straightforward:

- `GET /` - Create a new secret (text or file)
- `GET /secret/{id}` - Retrieve page for a specific secret
- `POST /web/secret` - Create text secret (web form)
- `POST /web/file` - Upload file secret (web form)
- `POST /web/retrieve` - Retrieve secret (web form)

The UI uses HTMX, so it's lightweight and works without a bunch of JavaScript.

## Security

### Application

- **Encryption**: AES-256-GCM with Argon2id key derivation (64MB memory, 3 iterations, 4 threads)
- **Storage**: Everything is in-memory only. Nothing is written to disk.
- **One-time retrieval**: Secrets are deleted immediately after being accessed.
- **Automatic cleanup**: Expired secrets are removed automatically.
- **Input validation**: All inputs are validated and sanitized.
- **XSS protection**: Templates auto-escape content.

### Nginx (Docker setup)

- Rate limiting: 10 req/s for API, 20 req/s for web interface
- Request size limit: 2.5MB max
- Security headers: HSTS, X-Frame-Options, CSP, etc.
- CORS: Configurable via `NGINX_CORS_ORIGIN`

## Docker Commands

```bash
# Start everything
docker-compose up -d

# Stop everything
docker-compose down

# View logs
docker-compose logs -f

# Restart
docker-compose restart

# Rebuild
docker-compose build
```

## Troubleshooting

**Container won't start?**
```bash
docker-compose logs app
docker-compose exec app nginx -t  # Test nginx config
```

**SSL issues?**
```bash
ls -la ssl/  # Make sure certs exist
openssl x509 -in ssl/cert.pem -text -noout  # Check cert validity
```

**Can't reach the backend?**
```bash
docker-compose ps  # Check if it's running
curl http://localhost:8000/health  # Test directly
docker-compose logs app  # Check logs
```

## Development

```bash
# Build
make build

# Run tests
go test ./...

# Format HTML templates
make format-html

# Update HTMX
make update-htmx
```

The project structure is pretty standard Go:

```
.
├── cmd/shhh/          # Main entry point
├── internal/
│   ├── config/        # Config parsing
│   ├── crypto/        # Encryption (AES + Argon2id)
│   ├── memstore/      # In-memory storage
│   ├── server/        # HTTP handlers and routes
│   └── validator/     # Input validation
├── ui/                # Web UI (templates + static files)
├── Dockerfile
├── docker-compose.yml
└── nginx.conf
```

## License

See LICENSE file.
